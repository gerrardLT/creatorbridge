# ğŸ¨ å‰ç«¯åŠŸèƒ½å±•ç¤ºæŒ‡å—

## ä¸€ã€è¡ç”Ÿä½œå“é“¾ä¸Šæ³¨å†ŒåŠŸèƒ½å±•ç°

### ğŸ“ å…¥å£ä½ç½®ï¼š`/create/derivative?parentId=xxx`

---

### 1.1 åˆ›å»ºè¡ç”Ÿä½œå“é¡µé¢

#### **é¡µé¢ç»“æ„ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† Back to Parent IP                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸŒ¿ Create Derivative Work                           â”‚
â”‚  Register a new IP based on an existing work         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ã€çˆ¶ IP ä¿¡æ¯å¡ç‰‡ã€‘                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Creating derivative of:                        â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”                                        â”‚ â”‚
â”‚  â”‚  â”‚å›¾ç‰‡â”‚ Original IP Title                      â”‚ â”‚
â”‚  â”‚  â”‚    â”‚ by Creator Name                        â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”˜ 10% revenue share to original creator  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ã€ä¸Šä¼ è¡ç”Ÿä½œå“ã€‘                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   ğŸ“¤                                           â”‚ â”‚
â”‚  â”‚   Click to upload your derivative work         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Title: [è¾“å…¥æ¡†]                                     â”‚
â”‚  Description: [æ–‡æœ¬æ¡†]                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âœ“ Attribution Required                             â”‚
â”‚  Your derivative work will be linked to the          â”‚
â”‚  original IP on-chain. Revenue sharing will be       â”‚
â”‚  automatically enforced via Story Protocol.          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ ğŸŒ¿ Register Derivative Work ]                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 1.2 å…³é”®è§†è§‰å…ƒç´ 

#### **çˆ¶ IP ä¿¡æ¯å¡ç‰‡**ï¼ˆç´«è‰²ä¸»é¢˜ï¼‰
```tsx
// æ–‡ä»¶ä½ç½®ï¼šapp/create/derivative/page.tsx ç¬¬ 172-190 è¡Œ
<div className="bg-purple-500/10 border border-purple-500/20 rounded-xl p-4">
  <p className="text-sm text-purple-400">Creating derivative of:</p>
  <div className="flex items-center gap-4">
    <img src={parentIp.imageUrl} className="w-20 h-20 rounded-lg" />
    <div>
      <h3>{parentIp.title}</h3>
      <p className="text-sm text-zinc-400">by {parentIp.creator?.name}</p>
      <p className="text-xs text-purple-400">
        {parentIp.commercialRevShare}% revenue share to original creator
      </p>
    </div>
  </div>
</div>
```

**è§†è§‰æ•ˆæœï¼š**
- ğŸŸ£ ç´«è‰²è¾¹æ¡†å’ŒèƒŒæ™¯ï¼ŒåŒºåˆ«äºå…¶ä»–åŠŸèƒ½
- ğŸ“¸ å±•ç¤ºçˆ¶ IP ç¼©ç•¥å›¾
- ğŸ’° æ˜ç¡®æ˜¾ç¤ºæ”¶ç›Šåˆ†æˆæ¯”ä¾‹

---

#### **è®¸å¯è¯éªŒè¯æç¤º**ï¼ˆçº¢è‰²è­¦å‘Šï¼‰
```tsx
// ç¬¬ 160-168 è¡Œ
{validationError && (
  <div className="bg-red-500/10 border border-red-500/30 rounded-xl p-6">
    <div className="flex items-start gap-3">
      <AlertTriangle className="w-6 h-6 text-red-400" />
      <div>
        <h3 className="font-medium text-red-400">Cannot Create Derivative</h3>
        <p className="text-red-300/70">{validationError}</p>
      </div>
    </div>
  </div>
)}
```

**éªŒè¯é€»è¾‘ï¼š**
- âœ… åªæœ‰ `COMMERCIAL_REMIX` è®¸å¯è¯å…è®¸åˆ›å»ºè¡ç”Ÿä½œå“
- âŒ å…¶ä»–è®¸å¯è¯ç±»å‹ä¼šæ˜¾ç¤ºé”™è¯¯æç¤º

---

#### **é“¾ä¸Šæ³¨å†ŒæˆåŠŸæç¤º**ï¼ˆé€šçŸ¥ç³»ç»Ÿï¼‰
```tsx
// ç¬¬ 89-99 è¡Œ
if (res.ok && data.success) {
  const message = data.onChain 
    ? 'ğŸ‰ Derivative registered on Story Protocol! Transaction confirmed.'
    : 'âœ… Derivative saved locally. Configure Story Protocol for on-chain registration.';
  addNotification('success', message);
  
  if (data.txHash) {
    console.log('âœ… Transaction Hash:', data.txHash);
    console.log('ğŸ”— View on Explorer:', `https://aeneid.storyscan.xyz/tx/${data.txHash}`);
  }
}
```

**ç”¨æˆ·åé¦ˆï¼š**
- ğŸ‰ **é“¾ä¸Šæ³¨å†ŒæˆåŠŸ**ï¼šç»¿è‰²é€šçŸ¥ + äº¤æ˜“å“ˆå¸Œé“¾æ¥
- âœ… **æœ¬åœ°ä¿å­˜**ï¼šé»„è‰²é€šçŸ¥ï¼ˆæœªé…ç½® Story Protocol æ—¶çš„é™çº§æ–¹æ¡ˆï¼‰

---

### 1.3 å®é™…æ“ä½œæµç¨‹

```mermaid
graph TB
    A[ç”¨æˆ·ç‚¹å‡» Create Derivative] --> B[éªŒè¯çˆ¶ IP è®¸å¯è¯]
    B --> C{æ˜¯ COMMERCIAL_REMIX?}
    C -->|æ˜¯| D[æ˜¾ç¤ºè¡¨å•]
    C -->|å¦| E[æ˜¾ç¤ºçº¢è‰²è­¦å‘Š]
    D --> F[ç”¨æˆ·å¡«å†™ä¿¡æ¯]
    F --> G[æäº¤è¡¨å•]
    G --> H{Story Protocol å·²é…ç½®?}
    H -->|æ˜¯| I[é“¾ä¸Šæ³¨å†Œ + ç»¿è‰²é€šçŸ¥]
    H -->|å¦| J[æœ¬åœ°ä¿å­˜ + é»„è‰²é€šçŸ¥]
    I --> K[è·³è½¬åˆ°è¡ç”Ÿ IP è¯¦æƒ…é¡µ]
    J --> K
```

---

## äºŒã€æ”¶ç›Šæ•°æ®é“¾ä¸ŠåŒæ­¥å±•ç°

### ğŸ“ å±•ç¤ºä½ç½®ï¼šIP è¯¦æƒ…é¡µçš„ `RoyaltyInfo` ç»„ä»¶

---

### 2.1 æ”¶ç›Šä¿¡æ¯å¡ç‰‡

#### **æ•´ä½“å¸ƒå±€ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ’° Royalty Information     [ âœ“ On-Chain Data ]      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚ğŸ“ˆ Rev Share  â”‚  â”‚ğŸ‘¥ Licenses   â”‚                 â”‚
â”‚  â”‚    10%       â”‚  â”‚      5       â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚ğŸŒ¿ Derivativesâ”‚  â”‚ğŸ’° Total Earnedâ”‚                â”‚
â”‚  â”‚      3       â”‚  â”‚  2.5 WIP     â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Revenue Breakdown                                   â”‚
â”‚  Direct Licenses ..................... 5             â”‚
â”‚  Derivative Royalties ................ 0.5000 WIP    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ”— Royalties from derivative works are              â”‚
â”‚     automatically distributed via Story Protocol     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 2.2 é“¾ä¸Šæ•°æ®çŠ¶æ€æŒ‡ç¤ºå™¨

#### **On-Chain Dataï¼ˆç»¿è‰²ï¼‰**
```tsx
// æ–‡ä»¶ä½ç½®ï¼šcomponents/RoyaltyInfo.tsx ç¬¬ 73-87 è¡Œ
{royaltyData.onChainDataAvailable !== undefined && (
  <div className="flex items-center gap-1.5 text-xs">
    {royaltyData.onChainDataAvailable ? (
      <>
        <CheckCircle className="w-3.5 h-3.5 text-green-400" />
        <span className="text-green-400 font-medium">On-Chain Data</span>
      </>
    ) : (
      <>
        <AlertCircle className="w-3.5 h-3.5 text-amber-400" />
        <span className="text-amber-400 font-medium">Local Estimate</span>
      </>
    )}
  </div>
)}
```

**è§†è§‰åŒºåˆ†ï¼š**
- âœ… **On-Chain Data**ï¼ˆç»¿è‰²ï¼‰ï¼šæ•°æ®ä» Story Protocol é“¾ä¸ŠæŸ¥è¯¢
- âš ï¸ **Local Estimate**ï¼ˆé»„è‰²ï¼‰ï¼šæ•°æ®æ¥è‡ªæœ¬åœ°æ•°æ®åº“ä¼°ç®—

---

### 2.3 å››å¤§æ ¸å¿ƒæŒ‡æ ‡

#### **1. Revenue Shareï¼ˆæ”¶ç›Šåˆ†æˆæ¯”ä¾‹ï¼‰**
```tsx
// ç¬¬ 91-100 è¡Œ
<div className="bg-zinc-800/50 rounded-lg p-3">
  <div className="flex items-center gap-2 text-zinc-400 text-sm">
    <TrendingUp className="w-4 h-4" />
    Revenue Share
  </div>
  <p className="text-2xl font-bold text-white">
    {royaltyData.revSharePercentage}%
  </p>
</div>
```

---

#### **2. Licenses Soldï¼ˆè®¸å¯è¯é”€å”®æ•°é‡ï¼‰**
```tsx
// ç¬¬ 102-111 è¡Œ
<div className="bg-zinc-800/50 rounded-lg p-3">
  <div className="flex items-center gap-2 text-zinc-400 text-sm">
    <Users className="w-4 h-4" />
    Licenses Sold
  </div>
  <p className="text-2xl font-bold text-white">
    {royaltyData.totalLicensesSold}
  </p>
</div>
```

---

#### **3. Derivativesï¼ˆè¡ç”Ÿä½œå“æ•°é‡ï¼‰**
```tsx
// ç¬¬ 113-122 è¡Œ
<div className="bg-zinc-800/50 rounded-lg p-3">
  <div className="flex items-center gap-2 text-zinc-400 text-sm">
    <GitBranch className="w-4 h-4" />
    Derivatives
  </div>
  <p className="text-2xl font-bold text-white">
    {royaltyData.derivativeCount}
  </p>
</div>
```

---

#### **4. Total Earnedï¼ˆç´¯è®¡æ”¶ç›Šï¼‰**
```tsx
// ç¬¬ 124-133 è¡Œ
<div className="bg-zinc-800/50 rounded-lg p-3">
  <div className="flex items-center gap-2 text-zinc-400 text-sm">
    <Coins className="w-4 h-4" />
    Total Earned
  </div>
  <p className="text-2xl font-bold text-indigo-400">
    {royaltyData.accumulatedRoyalties} {royaltyData.currency}
  </p>
</div>
```

**ç‰¹æ®Šæ ·å¼ï¼š**
- ğŸ’° ç´¯è®¡æ”¶ç›Šä½¿ç”¨ `text-indigo-400`ï¼ˆè“ç´«è‰²ï¼‰ï¼Œçªå‡ºæ˜¾ç¤º

---

### 2.4 æ”¶ç›Šåˆ†è§£é¢æ¿

```tsx
// ç¬¬ 136-153 è¡Œ
{(royaltyData.breakdown.directLicenses > 0 || 
  royaltyData.breakdown.derivativeRoyalties > 0) && (
  <div className="mt-4 pt-4 border-t border-white/10">
    <p className="text-xs text-zinc-400 mb-2">Revenue Breakdown</p>
    <div className="space-y-1.5">
      <div className="flex items-center justify-between text-sm">
        <span className="text-zinc-400">Direct Licenses</span>
        <span className="text-white font-medium">
          {royaltyData.breakdown.directLicenses}
        </span>
      </div>
      <div className="flex items-center justify-between text-sm">
        <span className="text-zinc-400">Derivative Royalties</span>
        <span className="text-indigo-400 font-medium">
          {royaltyData.breakdown.derivativeRoyalties.toFixed(4)} {royaltyData.currency}
        </span>
      </div>
    </div>
  </div>
)}
```

**æ•°æ®æ¥æºï¼š**
- **Direct Licenses**ï¼šç›´æ¥è´­ä¹°è®¸å¯è¯çš„æ•°é‡
- **Derivative Royalties**ï¼šè¡ç”Ÿä½œå“è‡ªåŠ¨åˆ†æˆçš„æ”¶ç›Š

---

### 2.5 è¡ç”Ÿä½œå“è¯¦ç»†åˆ—è¡¨

```tsx
// ç¬¬ 162-201 è¡Œ
{royaltyData.derivatives && royaltyData.derivatives.length > 0 && (
  <div className="bg-zinc-900/50 border border-zinc-800 rounded-xl p-5">
    <h4 className="text-sm font-semibold text-white mb-3 flex items-center gap-2">
      <GitBranch className="w-4 h-4 text-purple-400" />
      Derivative Works ({royaltyData.derivatives.length})
    </h4>
    <div className="space-y-2">
      {royaltyData.derivatives.map((derivative, index) => (
        <div className="bg-zinc-800/30 rounded-lg p-3">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-zinc-400">Derivative #{index + 1}</p>
              <p className="text-xs text-zinc-500 font-mono">
                {derivative.childIpId.slice(0, 8)}...{derivative.childIpId.slice(-6)}
              </p>
            </div>
            {derivative.txHash && (
              <a href={`https://aeneid.storyscan.xyz/tx/${derivative.txHash}`}
                 target="_blank"
                 className="text-indigo-400 hover:text-indigo-300">
                <ExternalLink className="w-4 h-4" />
              </a>
            )}
          </div>
          <p className="text-xs text-zinc-600 mt-1">
            Registered: {new Date(derivative.registeredAt).toLocaleDateString()}
          </p>
        </div>
      ))}
    </div>
  </div>
)}
```

**å±•ç¤ºä¿¡æ¯ï¼š**
- ğŸ“ è¡ç”Ÿä½œå“ç¼–å·
- ğŸ”‘ é“¾ä¸Š IP IDï¼ˆç®€åŒ–æ˜¾ç¤ºï¼‰
- ğŸ“… æ³¨å†Œæ—¥æœŸ
- ğŸ”— äº¤æ˜“å“ˆå¸Œé“¾æ¥ï¼ˆç‚¹å‡»è·³è½¬åˆ°åŒºå—é“¾æµè§ˆå™¨ï¼‰

---

## ä¸‰ã€IP å¡ç‰‡é“¾ä¸ŠçŠ¶æ€å¾½ç« 

### ğŸ“ å±•ç¤ºä½ç½®ï¼šå¸‚åœºæµè§ˆé¡µ (`/explore`)

---

### 3.1 ON-CHAIN å¾½ç« 

```tsx
// æ–‡ä»¶ä½ç½®ï¼šcomponents/IPCard.tsx ç¬¬ 46-51 è¡Œ
{asset.ipId && (
  <span className="bg-emerald-500/20 backdrop-blur-md border border-emerald-500/30 
                   text-emerald-400 text-[10px] font-bold px-2.5 py-1 rounded-full 
                   shadow-lg flex items-center gap-1">
    <CheckCircle className="w-3 h-3" />
    ON-CHAIN
  </span>
)}
```

**è§†è§‰æ•ˆæœï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ“ ON-CHAIN    [LICENSE]    â”‚  â† å¡ç‰‡å·¦ä¸Šè§’
â”‚                             â”‚
â”‚      [IP ä½œå“å›¾ç‰‡]           â”‚
â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ˜¾ç¤ºé€»è¾‘ï¼š**
- âœ… æœ‰ `ipId` å­—æ®µ = å·²é“¾ä¸Šæ³¨å†Œ â†’ æ˜¾ç¤ºç»¿è‰² ON-CHAIN å¾½ç« 
- âŒ æ—  `ipId` å­—æ®µ = ä»…æœ¬åœ°ä¿å­˜ â†’ ä¸æ˜¾ç¤ºå¾½ç« 

---

## å››ã€æ•°æ®æµå‘å›¾

### 4.1 è¡ç”Ÿä½œå“æ³¨å†Œæµç¨‹

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant F as å‰ç«¯é¡µé¢
    participant A as API Route
    participant S as Story Protocol
    participant D as æ•°æ®åº“

    U->>F: ç‚¹å‡» "Create Derivative"
    F->>A: GET /api/ip/:id (éªŒè¯çˆ¶ IP)
    A->>D: æŸ¥è¯¢çˆ¶ IP è®¸å¯è¯ç±»å‹
    D-->>A: è¿”å› COMMERCIAL_REMIX
    A-->>F: éªŒè¯é€šè¿‡
    
    U->>F: å¡«å†™è¡¨å•å¹¶æäº¤
    F->>A: POST /api/derivatives
    A->>S: registerDerivative()
    S-->>A: è¿”å› txHash + childIpId
    A->>D: ä¿å­˜è¡ç”Ÿå…³ç³»
    A-->>F: { success: true, onChain: true, txHash }
    
    F->>U: æ˜¾ç¤ºç»¿è‰²é€šçŸ¥ ğŸ‰
    F->>U: æ§åˆ¶å°è¾“å‡ºäº¤æ˜“é“¾æ¥
    F->>U: è·³è½¬åˆ°è¡ç”Ÿ IP è¯¦æƒ…é¡µ
```

---

### 4.2 æ”¶ç›Šæ•°æ®åŒæ­¥æµç¨‹

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant F as RoyaltyInfo ç»„ä»¶
    participant A as API Route
    participant S as Story Protocol
    participant D as æ•°æ®åº“

    U->>F: è®¿é—® IP è¯¦æƒ…é¡µ
    F->>A: GET /api/royalties/:ipId
    
    alt IP å·²é“¾ä¸Šæ³¨å†Œ
        A->>S: getRoyaltyData(ipId)
        S-->>A: { royaltyTokens, snapshotId }
        A->>A: onChainDataAvailable = true
    else IP æœªé“¾ä¸Šæ³¨å†Œ
        A->>D: æœ¬åœ°æ•°æ®åº“æŸ¥è¯¢
        D-->>A: æœ¬åœ°ä¼°ç®—æ•°æ®
        A->>A: onChainDataAvailable = false
    end
    
    A-->>F: è¿”å›æ”¶ç›Šæ•°æ® + é“¾ä¸ŠçŠ¶æ€æ ‡è¯†
    
    alt é“¾ä¸Šæ•°æ®
        F->>U: æ˜¾ç¤ºç»¿è‰² "On-Chain Data"
    else æœ¬åœ°æ•°æ®
        F->>U: æ˜¾ç¤ºé»„è‰² "Local Estimate"
    end
    
    F->>U: æ¸²æŸ“æ”¶ç›Šå¡ç‰‡å’Œè¡ç”Ÿåˆ—è¡¨
```

---

## äº”ã€å…³é”®ä»£ç ä½ç½®ç´¢å¼•

| åŠŸèƒ½ | æ–‡ä»¶ | å…³é”®ä»£ç è¡Œ |
|------|------|-----------|
| **è¡ç”Ÿä½œå“åˆ›å»ºé¡µé¢** | `app/create/derivative/page.tsx` | 1-308 |
| çˆ¶ IP éªŒè¯ | åŒä¸Š | 35-56 |
| è®¸å¯è¯ç±»å‹æ£€æŸ¥ | åŒä¸Š | 45-47 |
| é“¾ä¸Šæ³¨å†Œæäº¤ | åŒä¸Š | 66-110 |
| æˆåŠŸé€šçŸ¥å·®å¼‚åŒ– | åŒä¸Š | 89-99 |
| **æ”¶ç›Šä¿¡æ¯ç»„ä»¶** | `components/RoyaltyInfo.tsx` | 1-205 |
| é“¾ä¸ŠçŠ¶æ€æŒ‡ç¤ºå™¨ | åŒä¸Š | 73-87 |
| å››å¤§æ ¸å¿ƒæŒ‡æ ‡ | åŒä¸Š | 90-134 |
| æ”¶ç›Šåˆ†è§£é¢æ¿ | åŒä¸Š | 136-153 |
| è¡ç”Ÿä½œå“åˆ—è¡¨ | åŒä¸Š | 162-201 |
| **IP å¡ç‰‡ç»„ä»¶** | `components/IPCard.tsx` | 1-93 |
| ON-CHAIN å¾½ç«  | åŒä¸Š | 46-51 |

---

## å…­ã€ç”¨æˆ·ä½“éªŒç»†èŠ‚

### 6.1 é¢œè‰²è¯­è¨€

| åŠŸèƒ½çŠ¶æ€ | é¢œè‰² | å«ä¹‰ |
|----------|------|------|
| é“¾ä¸Šæ³¨å†ŒæˆåŠŸ | ğŸŸ¢ ç»¿è‰²ï¼ˆemerald-400ï¼‰ | æ•°æ®å·²ä¸Šé“¾ï¼Œå®Œå…¨å»ä¸­å¿ƒåŒ– |
| æœ¬åœ°æ•°æ® | ğŸŸ¡ é»„è‰²ï¼ˆamber-400ï¼‰ | æ•°æ®ä»…æœ¬åœ°ä¿å­˜ï¼Œæœªä¸Šé“¾ |
| è¡ç”Ÿä½œå“ | ğŸŸ£ ç´«è‰²ï¼ˆpurple-400ï¼‰ | è¡ç”Ÿå…³ç³»æ ‡è¯† |
| æ”¶ç›Šæ•°æ® | ğŸ”µ è“ç´«è‰²ï¼ˆindigo-400ï¼‰ | æ”¶ç›Šé‡‘é¢çªå‡ºæ˜¾ç¤º |
| é”™è¯¯è­¦å‘Š | ğŸ”´ çº¢è‰²ï¼ˆred-400ï¼‰ | ä¸å…è®¸çš„æ“ä½œ |

---

### 6.2 äº¤äº’åé¦ˆ

| æ“ä½œ | åé¦ˆæ–¹å¼ |
|------|----------|
| æäº¤è¡ç”Ÿä½œå“ | æŒ‰é’®æ˜¾ç¤ºåŠ è½½åŠ¨ç”» + æ–‡å­—å˜ä¸º "Registering Derivative..." |
| æ³¨å†ŒæˆåŠŸï¼ˆé“¾ä¸Šï¼‰ | ç»¿è‰²é€šçŸ¥ + äº¤æ˜“å“ˆå¸Œæ§åˆ¶å°è¾“å‡º + è‡ªåŠ¨è·³è½¬ |
| æ³¨å†ŒæˆåŠŸï¼ˆæœ¬åœ°ï¼‰ | é»„è‰²é€šçŸ¥ + é…ç½®æç¤º + è‡ªåŠ¨è·³è½¬ |
| è®¸å¯è¯éªŒè¯å¤±è´¥ | çº¢è‰²è­¦å‘Šæ¡† + ç¦ç”¨è¡¨å• |
| æŸ¥è¯¢æ”¶ç›Šæ•°æ® | åŠ è½½åŠ¨ç”» â†’ æ•°æ®å¡ç‰‡æ¸å…¥ |
| ç‚¹å‡»äº¤æ˜“å“ˆå¸Œ | æ–°æ ‡ç­¾é¡µæ‰“å¼€åŒºå—é“¾æµè§ˆå™¨ |

---

### 6.3 å“åº”å¼è®¾è®¡

```css
/* æ”¶ç›Šä¿¡æ¯å¡ç‰‡ - 2x2 ç½‘æ ¼å¸ƒå±€ */
grid-cols-2 gap-4

/* ç§»åŠ¨ç«¯è‡ªé€‚åº” */
@media (max-width: 640px) {
  grid-cols-1 /* å˜ä¸ºå•åˆ— */
}
```

---

## ä¸ƒã€å®é™…ç•Œé¢æˆªå›¾æ–‡å­—æè¿°

### 7.1 è¡ç”Ÿä½œå“åˆ›å»ºé¡µé¢

```
æ ‡é¢˜åŒºåŸŸï¼š
  ğŸŒ¿ Create Derivative Work
  Register a new IP based on an existing work

çˆ¶ IP å¡ç‰‡ï¼ˆç´«è‰²æ¸å˜èƒŒæ™¯ï¼‰ï¼š
  Creating derivative of:
  [ç¼©ç•¥å›¾] Original AI Portrait
          by Alice Chen
          10% revenue share to original creator

è¡¨å•åŒºåŸŸï¼š
  - ä¸Šä¼ åŒºåŸŸï¼ˆè™šçº¿è¾¹æ¡†ï¼Œæ‚¬åœå˜ç´«è‰²ï¼‰
  - æ ‡é¢˜è¾“å…¥æ¡†ï¼ˆæ·±è‰²èƒŒæ™¯ï¼Œç´«è‰²è¾¹æ¡†èšç„¦ï¼‰
  - æè¿°æ–‡æœ¬æ¡†ï¼ˆå¤šè¡Œè¾“å…¥ï¼‰
  
æç¤ºåŒºåŸŸï¼ˆç»¿è‰²å¯¹å‹¾å›¾æ ‡ï¼‰ï¼š
  âœ“ Attribution Required
  Your derivative work will be linked to the original IP on-chain.

æäº¤æŒ‰é’®ï¼ˆç´«è‰²èƒŒæ™¯ï¼Œå…¨å®½ï¼‰ï¼š
  ğŸŒ¿ Register Derivative Work
```

---

### 7.2 æ”¶ç›Šä¿¡æ¯å¡ç‰‡

```
æ ‡é¢˜æ ï¼š
  ğŸ’° Royalty Information          [ âœ“ On-Chain Data ]
                                    (ç»¿è‰²ï¼Œé“¾ä¸Šæ•°æ®æ ‡è¯†)

å››å®«æ ¼æŒ‡æ ‡ï¼ˆæ·±è‰²èƒŒæ™¯ï¼‰ï¼š
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ ğŸ“ˆ Rev Share â”‚ ğŸ‘¥ Licenses  â”‚
  â”‚    10%       â”‚      5       â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ ğŸŒ¿ Derivativesâ”‚ ğŸ’° Total    â”‚
  â”‚      3       â”‚  2.5 WIP     â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åˆ†å‰²çº¿

æ”¶ç›Šåˆ†è§£ï¼š
  Revenue Breakdown
  Direct Licenses ..................... 5
  Derivative Royalties ................ 0.5000 WIP
                                        (è“ç´«è‰²é«˜äº®)

æç¤ºä¿¡æ¯ï¼ˆç°è‰²å°å­—ï¼‰ï¼š
  ğŸ”— Royalties from derivative works are automatically 
     distributed via Story Protocol

---

è¡ç”Ÿä½œå“åˆ—è¡¨ï¼ˆç‹¬ç«‹å¡ç‰‡ï¼Œæ·±è‰²èƒŒæ™¯ï¼‰ï¼š
  ğŸŒ¿ Derivative Works (3)
  
  [Derivative #1]
  0x1a2b3c4d...5e6f7g
  Registered: 12/1/2024        [ğŸ”— å¤–éƒ¨é“¾æ¥å›¾æ ‡]
  
  [Derivative #2]
  0x8h9i0j1k...2l3m4n
  Registered: 11/28/2024       [ğŸ”—]
```

---

## å…«ã€æ€§èƒ½ä¼˜åŒ–

### 8.1 åŠ è½½çŠ¶æ€

```tsx
// RoyaltyInfo.tsx ç¬¬ 53-59 è¡Œ
if (isLoading) {
  return (
    <div className="flex items-center justify-center py-6">
      <Loader2 className="w-6 h-6 text-indigo-500 animate-spin" />
    </div>
  );
}
```

**åŠ è½½æµç¨‹ï¼š**
1. ç”¨æˆ·è®¿é—® IP è¯¦æƒ…é¡µ
2. æ˜¾ç¤ºæ—‹è½¬åŠ è½½å›¾æ ‡ï¼ˆè“ç´«è‰²ï¼‰
3. æ•°æ®è·å–å®Œæˆåæ·¡å…¥æ˜¾ç¤ºå¡ç‰‡

---

### 8.2 é”™è¯¯é™çº§

```tsx
// ç¬¬ 61-63 è¡Œ
if (!royaltyData) {
  return null; // æ•°æ®è·å–å¤±è´¥æ—¶ä¸æ˜¾ç¤ºç»„ä»¶
}
```

**å®¹é”™ç­–ç•¥ï¼š**
- API å¤±è´¥ä¸å½±å“é¡µé¢å…¶ä»–éƒ¨åˆ†
- é“¾ä¸ŠæŸ¥è¯¢å¤±è´¥æ—¶è‡ªåŠ¨ä½¿ç”¨æœ¬åœ°æ•°æ®
- ç”¨æˆ·æ— æ„ŸçŸ¥é™çº§

---

## ä¹ã€å¼€å‘è€…è°ƒè¯•ä¿¡æ¯

### 9.1 æ§åˆ¶å°è¾“å‡º

```javascript
// è¡ç”Ÿä½œå“æ³¨å†ŒæˆåŠŸæ—¶
console.log('âœ… Transaction Hash:', data.txHash);
console.log('ğŸ”— View on Explorer:', `https://aeneid.storyscan.xyz/tx/${data.txHash}`);
```

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
âœ… Transaction Hash: 0x1a2b3c4d5e6f7g8h9i0j1k2l3m4n5o6p7q8r9s0t1u2v3w4x5y6z7a8b9c0d1e2f
ğŸ”— View on Explorer: https://aeneid.storyscan.xyz/tx/0x1a2b3c4d...
```

---

## åã€æ€»ç»“

### âœ… è¡ç”Ÿä½œå“é“¾ä¸Šæ³¨å†Œ - å‰ç«¯å±•ç°

1. **è¡¨å•éªŒè¯**ï¼šçº¢è‰²è­¦å‘Šæç¤ºä¸å…è®¸çš„è®¸å¯è¯ç±»å‹
2. **çˆ¶ IP ä¿¡æ¯**ï¼šç´«è‰²å¡ç‰‡å±•ç¤ºåŸä½œä¿¡æ¯å’Œæ”¶ç›Šåˆ†æˆ
3. **æäº¤åé¦ˆ**ï¼šå·®å¼‚åŒ–é€šçŸ¥ï¼ˆé“¾ä¸Š=ç»¿è‰²ï¼Œæœ¬åœ°=é»„è‰²ï¼‰
4. **äº¤æ˜“è¿½è¸ª**ï¼šæ§åˆ¶å°è¾“å‡ºåŒºå—é“¾æµè§ˆå™¨é“¾æ¥

---

### âœ… æ”¶ç›Šæ•°æ®é“¾ä¸ŠåŒæ­¥ - å‰ç«¯å±•ç°

1. **çŠ¶æ€æŒ‡ç¤ºå™¨**ï¼šç»¿è‰² "On-Chain Data" vs é»„è‰² "Local Estimate"
2. **æ ¸å¿ƒæŒ‡æ ‡**ï¼š4 ä¸ªå¡ç‰‡å±•ç¤ºæ”¶ç›Šã€è®¸å¯è¯ã€è¡ç”Ÿä½œå“ã€ç´¯è®¡æ”¶ç›Š
3. **æ”¶ç›Šåˆ†è§£**ï¼šåŒºåˆ†ç›´æ¥è®¸å¯å’Œè¡ç”Ÿåˆ†æˆ
4. **è¡ç”Ÿåˆ—è¡¨**ï¼šå±•ç¤ºæ‰€æœ‰è¡ç”Ÿä½œå“ + äº¤æ˜“å“ˆå¸Œé“¾æ¥
5. **å®æ—¶æŸ¥è¯¢**ï¼šä¼˜å…ˆæŸ¥è¯¢é“¾ä¸Šæ•°æ®ï¼Œå¤±è´¥æ—¶é™çº§åˆ°æœ¬åœ°

---

**è§†è§‰è®¾è®¡åŸåˆ™ï¼š**
- ğŸŸ¢ é“¾ä¸Šæ•°æ® = ç»¿è‰²ï¼ˆä¿¡ä»»ã€å»ä¸­å¿ƒåŒ–ï¼‰
- ğŸŸ¡ æœ¬åœ°æ•°æ® = é»„è‰²ï¼ˆè­¦å‘Šã€ä¸´æ—¶ï¼‰
- ğŸŸ£ è¡ç”Ÿå…³ç³» = ç´«è‰²ï¼ˆè¿æ¥ã€åˆ›æ„ï¼‰
- ğŸ”µ æ”¶ç›Šé‡‘é¢ = è“ç´«è‰²ï¼ˆä»·å€¼ã€çªå‡ºï¼‰

**ç”¨æˆ·ä½“éªŒæ ¸å¿ƒï¼š**
- âœ… æ¸…æ™°çš„çŠ¶æ€åé¦ˆ
- âœ… é€æ˜çš„æ•°æ®æ¥æºæ ‡è¯†
- âœ… å¯è¿½æº¯çš„äº¤æ˜“é“¾æ¥
- âœ… ä¼˜é›…çš„é”™è¯¯é™çº§
