# 📋 许可证模板功能完整指南

## 目录
1. [模板在哪里显示](#模板在哪里显示)
2. [完整使用流程](#完整使用流程)
3. [界面截图说明](#界面截图说明)
4. [常见问题](#常见问题)

---

## 模板在哪里显示？

### 📍 **位置：创建页面的表单中**

访问路径：`http://localhost:3001/create`

在表单中的位置：

```
创建 IP 表单
├─ 1. Asset File (文件上传) ✅
├─ 2. Title (标题输入) ✅
├─ 3. Description (描述输入) ✅
├─ 4. 📋 Load from Template (模板选择器) ← 在这里！
├─ 5. License Type (许可证类型)
├─ 6. Minting Fee (铸造费用)
├─ 7. Revenue Share (收益分成)
├─ 8. 💾 Save License as Template (保存模板按钮)
└─ 9. Mint to Story Protocol (提交按钮)
```

---

## 完整使用流程

### 🔄 **流程 1：保存模板**

#### **步骤 1：配置许可证**

```
1. 上传文件（图片或音频）
2. 填写标题和描述
3. 选择许可证类型
   ┌────────────────────────────────┐
   │ ○ Non-Commercial               │
   │ ● Commercial Use               │  ← 选择
   │ ○ Commercial Remix             │
   └────────────────────────────────┘

4. 设置 Minting Fee
   ┌────────────────────────────────┐
   │ Minting Fee: [0.1] WIP         │
   └────────────────────────────────┘

5. （如果选择 Commercial Remix）设置 Revenue Share
   ┌────────────────────────────────┐
   │ Revenue Share: [10]%           │
   └────────────────────────────────┘
```

#### **步骤 2：保存为模板**

```
6. 向下滚动，找到保存按钮

   ┌─────────────────────────────────────┐
   │                                     │
   │  💾 Save License as Template        │  ← 点击这个按钮
   │                                     │
   └─────────────────────────────────────┘
```

#### **步骤 3：填写模板名称**

```
弹窗出现：

┌──────────────────────────────────────┐
│  Save as Template                 ✕  │
├──────────────────────────────────────┤
│                                      │
│  Template Name                       │
│  ┌────────────────────────────────┐  │
│  │ Design Assets 0.1 WIP          │  │  ← 输入模板名称
│  └────────────────────────────────┘  │
│                                      │
│  Template will save:                 │
│  ┌────────────────────────────────┐  │
│  │ License Type: Commercial Use   │  │
│  │ Minting Fee: 0.1 WIP           │  │  ← 预览配置
│  └────────────────────────────────┘  │
│                                      │
│     [Cancel]  [💾 Save Template]    │
└──────────────────────────────────────┘
```

#### **步骤 4：保存成功**

```
点击 "Save Template" 后：

✅ 右上角出现成功通知
┌──────────────────────────────────────┐
│ ✅ Template "Design Assets 0.1 WIP"  │
│    saved successfully!               │
└──────────────────────────────────────┘

🔄 模板列表自动刷新
📋 新模板立即可用
```

---

### 🔄 **流程 2：使用模板**

#### **步骤 1：找到模板选择器**

```
在创建页面，填写完 Title 和 Description 后，
你会看到：

┌──────────────────────────────────────┐
│ Load from Template                   │
│ ┌──────────────────────────────────┐ │
│ │ Select a template...          ▼  │ │  ← 点击这里
│ └──────────────────────────────────┘ │
└──────────────────────────────────────┘
```

#### **步骤 2：选择模板**

```
下拉框展开，显示所有已保存的模板：

┌──────────────────────────────────────┐
│ Design Assets 0.1 WIP                │  ← 刚保存的模板
│ Commercial Use                       │
│ 0.1 WIP                              │
├──────────────────────────────────────┤
│ Music Standard                       │  ← 之前保存的模板
│ Commercial Remix                     │
│ 0.2 WIP · 15% rev share              │
├──────────────────────────────────────┤
│ Free Educational                     │  ← 另一个模板
│ Non-Commercial                       │
└──────────────────────────────────────┘

点击任意一个模板
```

#### **步骤 3：自动填充配置**

```
选择模板后，下面的配置会自动填充：

✅ License Type: Commercial Use (自动选中)
✅ Minting Fee: 0.1 WIP (自动填写)
✅ Revenue Share: 10% (如果适用，自动填写)

你可以：
- 直接提交（使用模板配置）
- 微调参数后提交
- 保存为新模板（如果修改了参数）
```

---

## 界面截图说明

### 📸 **完整界面布局**

```
┌─────────────────────────────────────────────────────────┐
│ Story Protocol - Create IP                              │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  Register new intellectual property on Story Protocol. │
│                                                         │
│  ┌──────────────────────┐  ┌──────────────────────┐   │
│  │                      │  │                      │   │
│  │  表单区域            │  │  预览区域            │   │
│  │                      │  │                      │   │
│  │  ┌────────────────┐ │  │  ┌────────────────┐ │   │
│  │  │ 1. 文件上传    │ │  │  │    图片/音频    │ │   │
│  │  └────────────────┘ │  │  │    预览        │ │   │
│  │                      │  │  └────────────────┘ │   │
│  │  ┌────────────────┐ │  │                      │   │
│  │  │ 2. 标题        │ │  │  Title: XXX          │   │
│  │  └────────────────┘ │  │  Creator: YYY        │   │
│  │                      │  │  Price: 0.1 WIP      │   │
│  │  ┌────────────────┐ │  │                      │   │
│  │  │ 3. 描述        │ │  └──────────────────────┘   │
│  │  └────────────────┘ │                             │
│  │                      │                             │
│  │  ┌────────────────┐ │                             │
│  │  │ 📋 模板选择器  │ │  ← 在这里！                 │
│  │  └────────────────┘ │                             │
│  │                      │                             │
│  │  ┌────────────────┐ │                             │
│  │  │ 4. 许可证类型  │ │                             │
│  │  └────────────────┘ │                             │
│  │                      │                             │
│  │  ┌────────────────┐ │                             │
│  │  │ 5. 费用配置    │ │                             │
│  │  └────────────────┘ │                             │
│  │                      │                             │
│  │  ┌────────────────┐ │                             │
│  │  │ 💾 保存模板    │ │  ← 保存按钮                 │
│  │  └────────────────┘ │                             │
│  │                      │                             │
│  │  ┌────────────────┐ │                             │
│  │  │ 🚀 提交        │ │                             │
│  │  └────────────────┘ │                             │
│  │                      │                             │
│  └──────────────────────┘                             │
└─────────────────────────────────────────────────────────┘
```

---

### 📋 **模板选择器详细视图**

#### **未选择状态**

```
┌──────────────────────────────────────┐
│ Load from Template                   │  ← 灰色标签
│ ┌──────────────────────────────────┐ │
│ │ 📄 Select a template...       ▼  │ │  ← 灰色文字，点击展开
│ └──────────────────────────────────┘ │
└──────────────────────────────────────┘
```

#### **展开状态（有 3 个模板）**

```
┌──────────────────────────────────────┐
│ Load from Template                   │
│ ┌──────────────────────────────────┐ │
│ │ 📄 Select a template...       ▲  │ │
│ └──────────────────────────────────┘ │
│                                      │
│  ┌────────────────────────────────┐  │  ← 悬停时高亮
│  │ Design Assets Standard         │  │
│  │ [Commercial Use]               │  │  ← 许可证类型徽章
│  │ 0.1 WIP                        │  │  ← 费用信息
│  └────────────────────────────────┘  │
│  ┌────────────────────────────────┐  │
│  │ Music Remix 15%                │  │
│  │ [Commercial Remix]             │  │
│  │ 0.2 WIP · 15% rev share        │  │
│  └────────────────────────────────┘  │
│  ┌────────────────────────────────┐  │
│  │ Free Educational Use           │  │
│  │ [Non-Commercial]               │  │
│  └────────────────────────────────┘  │
└──────────────────────────────────────┘
```

#### **已选择状态**

```
┌──────────────────────────────────────┐
│ Load from Template                   │
│ ┌──────────────────────────────────┐ │
│ │ 📄 Music Remix 15%            ▼  │ │  ← 白色文字，显示选中的模板
│ └──────────────────────────────────┘ │
└──────────────────────────────────────┘

下面的许可证配置自动填充：
✅ License Type: Commercial Remix
✅ Minting Fee: 0.2 WIP
✅ Revenue Share: 15%
```

#### **没有模板时**

```
（此区域不显示，自动隐藏）

第一次使用时看不到 "Load from Template"，
需要先保存至少一个模板后才会出现。
```

---

### 💾 **保存模板弹窗**

#### **初始状态**

```
┌────────────────────────────────────────┐
│ Save as Template                    ✕ │
├────────────────────────────────────────┤
│                                        │
│ Template Name                          │
│ ┌────────────────────────────────────┐ │
│ │ [光标闪烁]                         │ │  ← 空白输入框
│ └────────────────────────────────────┘ │
│                                        │
│ Template will save:                    │
│ ┌────────────────────────────────────┐ │
│ │ License Type: Commercial Use       │ │
│ │ Minting Fee: 0.1 WIP               │ │  ← 当前配置预览
│ └────────────────────────────────────┘ │
│                                        │
│    [Cancel]  [💾 Save Template]       │  ← Save 按钮禁用（灰色）
└────────────────────────────────────────┘
```

#### **输入名称后**

```
┌────────────────────────────────────────┐
│ Save as Template                    ✕ │
├────────────────────────────────────────┤
│                                        │
│ Template Name                          │
│ ┌────────────────────────────────────┐ │
│ │ My Design Template                 │ │  ← 已输入名称
│ └────────────────────────────────────┘ │
│                                        │
│ Template will save:                    │
│ ┌────────────────────────────────────┐ │
│ │ License Type: Commercial Use       │ │
│ │ Minting Fee: 0.1 WIP               │ │
│ └────────────────────────────────────┘ │
│                                        │
│    [Cancel]  [💾 Save Template]       │  ← Save 按钮激活（紫色）
└────────────────────────────────────────┘
```

#### **保存中状态**

```
┌────────────────────────────────────────┐
│ Save as Template                    ✕ │
├────────────────────────────────────────┤
│                                        │
│ Template Name                          │
│ ┌────────────────────────────────────┐ │
│ │ My Design Template                 │ │
│ └────────────────────────────────────┘ │
│                                        │
│ Template will save:                    │
│ ┌────────────────────────────────────┐ │
│ │ License Type: Commercial Use       │ │
│ │ Minting Fee: 0.1 WIP               │ │
│ └────────────────────────────────────┘ │
│                                        │
│    [Cancel]  [🔄 ...]                 │  ← 加载动画
└────────────────────────────────────────┘
```

#### **重名确认**

```
┌────────────────────────────────────────┐
│ Save as Template                    ✕ │
├────────────────────────────────────────┤
│                                        │
│ ⚠️ Template already exists             │
│ ┌────────────────────────────────────┐ │
│ │ A template named                   │ │
│ │ "My Design Template" already       │ │
│ │ exists. Do you want to             │ │
│ │ overwrite it?                      │ │
│ └────────────────────────────────────┘ │
│                                        │
│       [Cancel]  [Overwrite]            │  ← 黄色确认按钮
└────────────────────────────────────────┘
```

---

### 🎉 **成功通知**

```
页面右上角（4 秒后自动消失）：

┌────────────────────────────────────────┐
│ ✅ Template "My Design Template"       │
│    saved successfully!                 │
└────────────────────────────────────────┘
   └─ 绿色边框，白色背景，绿色图标
```

---

## 常见问题

### ❓ **Q1: 我保存了模板，为什么看不到？**

**A:** 检查以下几点：

1. ✅ **确保已登录钱包**
   - 模板绑定到用户账号
   - 未登录时不显示模板选择器

2. ✅ **刷新页面**
   - 虽然现在已支持自动刷新
   - 如果还是看不到，手动刷新一下

3. ✅ **检查保存是否成功**
   - 保存后应该看到绿色成功通知
   - 如果没看到，说明保存失败

---

### ❓ **Q2: 模板选择器在哪里？我找不到！**

**A:** 模板选择器的显示条件：

```
显示条件：
1. ✅ 用户已登录
2. ✅ 至少保存了 1 个模板

如果没有模板：
- 模板选择器会自动隐藏
- 先保存一个模板后就会出现了
```

**位置：**
```
创建页面表单中
├─ 文件上传
├─ 标题
├─ 描述
├─ 📋 这里！（Title 和 Description 下面）
└─ 许可证类型
```

---

### ❓ **Q3: 选择模板后还能修改参数吗？**

**A:** 可以！

```
选择模板后的操作：

1. ✅ 直接提交
   - 使用模板的默认配置
   
2. ✅ 修改参数后提交
   - License Type 可以改
   - Minting Fee 可以调整
   - Revenue Share 可以修改
   
3. ✅ 修改后另存为新模板
   - 修改参数
   - 点击 "Save License as Template"
   - 输入新名称
   - 保存为新模板
```

---

### ❓ **Q4: 可以删除模板吗？**

**A:** 目前版本不支持删除模板。

**解决方法：**
```
1. 覆盖同名模板
   - 保存时使用相同名称
   - 系统会提示覆盖
   - 确认后会替换旧配置

2. 未来计划
   - 下一版本会添加模板管理页面
   - 支持查看、编辑、删除模板
```

---

### ❓ **Q5: 模板可以跨设备使用吗？**

**A:** 可以！

```
模板存储：
- 保存在数据库中
- 绑定到钱包地址

跨设备使用：
1. 在设备 A 保存模板
2. 在设备 B 连接同一个钱包
3. 自动加载所有模板
4. 无缝使用
```

---

### ❓ **Q6: 我可以保存多少个模板？**

**A:** 无限制！

```
模板数量：
- ✅ 无上限
- ✅ 按时间倒序排列（最新的在最上面）
- ✅ 下拉框支持滚动（超过 4 个时）
```

---

### ❓ **Q7: Non-Commercial 类型的模板会保存费用吗？**

**A:** 不会。

```
不同许可证类型保存的参数：

Non-Commercial:
├─ License Type: ✅
├─ Minting Fee: ❌ (自动为 0)
└─ Revenue Share: ❌ (不适用)

Commercial Use:
├─ License Type: ✅
├─ Minting Fee: ✅
└─ Revenue Share: ❌ (不适用)

Commercial Remix:
├─ License Type: ✅
├─ Minting Fee: ✅
└─ Revenue Share: ✅
```

---

## 高级使用技巧

### 💡 **技巧 1：为不同项目类型创建不同模板**

```
音乐作品：
├─ "Music Standard" (0.2 WIP, 10% rev share)
├─ "Music Premium" (0.5 WIP, 15% rev share)
└─ "Music Free Promo" (Non-Commercial)

设计素材：
├─ "Logo Design" (0.5 WIP)
├─ "Icon Pack" (0.1 WIP)
└─ "Illustration" (0.3 WIP)

AI 艺术：
├─ "AI Art Standard" (0.1 WIP)
└─ "AI Art Remix" (0.1 WIP, 5% rev share)
```

---

### 💡 **技巧 2：使用描述性命名**

```
❌ 不好的名称：
- "Template 1"
- "Test"
- "My Template"

✅ 好的名称：
- "Design 0.1 WIP"
- "Music Remix 15%"
- "Free Educational"
- "Commercial Standard 0.5"
```

**命名建议：**
```
格式：[类型] + [费用] + [特殊标记]

例如：
- "Logo 0.5 WIP"
- "Music 0.2 + 10%"
- "AI Art Free"
- "Premium 1.0 WIP"
```

---

### 💡 **技巧 3：快速工作流**

```
场景：批量上传同类型 IP

步骤：
1. 第一次创建时配置完整参数
2. 保存为模板 "Batch Upload Template"
3. 后续创建只需：
   ├─ 上传文件
   ├─ 填写标题和描述
   ├─ 选择模板（自动填充配置）
   └─ 直接提交

效率提升：
- 节省 80% 配置时间
- 避免参数错误
- 保持统一定价
```

---

### 💡 **技巧 4：模板版本管理**

```
随着时间推移，调整定价策略：

v1.0 模板：
"Design Standard v1" (0.1 WIP)

v2.0 模板：
"Design Standard v2" (0.15 WIP)

v3.0 模板：
"Design Standard v3" (0.2 WIP)

好处：
- 保留历史定价记录
- 对比不同版本效果
- 灵活切换策略
```

---

## 技术实现细节

### 🔧 **自动刷新机制**

```typescript
// 使用 key 强制重新渲染
const [templateRefreshKey, setTemplateRefreshKey] = useState(0);

<TemplateSelector
  key={templateRefreshKey}  // ← 关键！
  userId={user?.id || null}
  onSelect={handleTemplateSelect}
/>

// 保存成功后触发刷新
setTemplateRefreshKey(prev => prev + 1);
```

**工作原理：**
1. 保存模板成功
2. `templateRefreshKey` 从 0 变为 1
3. React 检测到 key 变化
4. 卸载旧组件，重新挂载新组件
5. 新组件 `useEffect` 触发
6. 调用 `fetchTemplates()` 获取最新数据
7. 包含刚保存的模板

---

### 🔧 **条件显示逻辑**

```typescript
// TemplateSelector.tsx
if (!userId || templates.length === 0) {
  return null;  // 没有用户或没有模板时不显示
}
```

**显示条件：**
```
条件 1: userId 存在
  └─ 用户已登录

条件 2: templates.length > 0
  └─ 至少有一个模板

两者都满足 → 显示选择器
任何一个不满足 → 隐藏选择器
```

---

## 总结

### ✅ **模板功能核心要点**

1. **位置**
   - `/create` 页面表单中
   - Title/Description 下面
   - License Type 上面

2. **使用流程**
   - 配置 → 保存 → 成功通知 → 立即可用
   - 选择 → 自动填充 → 提交

3. **显示条件**
   - 必须登录
   - 至少有 1 个模板

4. **自动刷新**
   - 保存后立即刷新
   - 无需手动刷新页面

5. **智能隐藏**
   - 没有模板时自动隐藏
   - 避免空白选择器

---

**开始使用模板功能，提升创作效率！** 🚀
